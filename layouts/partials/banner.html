{{/* If banner not explicitly deactivated on page ('banner: false' on front matter) */}}
{{- if not (eq .Params.banner false) -}}

  {{/* Get 'banner' from front matter, complete with default values */}}
  {{- $banner := dict "src" "" "caption" "" "href" "" -}}
  {{- if .Params.banner -}}
    {{- $banner = merge $banner .Params.banner -}}
  {{- end -}}

  {{/* Try to get banner as page resource */}}
  {{- with .Resources.GetMatch $banner.src -}}
    {{- $banner = merge $banner (dict "resource" .) -}}
    {{- partial "banner-figure" $banner }}

  {{- else -}}

    {{/* Or try to get the banner resource with the same filename as the page */}}
    {{- if and .File .Parent -}}
      {{- $src := printf "%s.*" .File.BaseFileName -}}
      {{- $resource := .Parent.Resources.GetMatch $src -}}
      {{- $banner = merge $banner (dict "src" $src "resource" $resource) }}
    {{- end -}}

    {{- if $banner.resource -}}
      {{- partial "banner-figure" $banner }}

    {{- else -}}

      {{/* Or try to get the default banner resource */}}
      {{- $src := .Site.Params.banner | default "banner.*" -}}
      {{- with .Resources.GetMatch $src -}}
        {{- $banner = merge $banner (dict "src" $src "resource" .) }}
        {{- partial "banner-figure" $banner }}

      {{- else -}}

        {{/* Or try to get the parent banner as fallback */}}
        {{- with .Parent -}}
          {{- partial "banner" . -}}
        {{- end -}}

      {{- end -}}

    {{- end -}}

  {{- end -}}

{{- end -}}
